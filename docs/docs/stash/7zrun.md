[![logo](../../logo.png)](../stash.md "documentation") 

[H]: ../stash.md           "родитель"
[P]: ../../icons/progress.png  "в процессе..."
[S]: ../../icons/success.png   "ошибок не обнаружено"
   
[![P]][H] 7zrun v0.0.1
======================
Батник запускает архиватор 7z, и его руками делает бэкапы вида:  
```
repo
 |--- _stash
 |     |--- example_gtest                    
 |     |     |
 |     |     |--- _backup
 |           |     |
 |           |     |--- example_gtest-v001
 |           |     |     |--- [2025-12m-04][12h-35m]-REL.7z 
 |           |     |      `-- [2025-12m-04][14h-10m]-REL.7z
 |           |     |--- example_gtest-v002
 |           |     |     |--- [2025-12m-05][19h-55m]-REL.7z
 |           |     |      `-- [2025-12m-05][20h-15m]-REL.7z
 |           |      `-- example_gtest-v003
 |           |           |--- [2025-12m-06][12h-42m]-REL.7z
 |           |            `-- [2025-12m-06][15h-58m]-REL.7z
 |            `-- 7zrun.bat
 |
  `-- example_gtest
```

Батник специально разрабатывался для обслуживания сундуков проектов,  
но может работать и как самостоятельный скрипт, в режиме "без сундука"  


eDEBUG
------
`eDEBUG=ON` вкл. отладочный вывод  
По умолчанию: выкл.  


eDIR_7Z
-------
`eDIR_7Z=C:\Program Files\7-Zip` местоположение архиватора 7z  
По умолчанию: скрипт попытается найти архиватор, анализируя PATH,  
а так же, выполняя поиск в `Program Files`  


eDIR_WORK
---------
`eDIR_WORK=C:\Program Files\7-Zip` рабочий каталог  
По умолчанию: совпадает с каталогом, откуда был запущен скрипт.  
И обычно это - каталог сундука.  


eNAME7Z
-------
`eNAME7Z=sample` имя архива  
По умолчанию: совпадает с eNAME_WORK - имя каталога `eDIR_WORK`  


eNOSTASH
--------
`eNOSTASH=ON` режим работы "без стеша"  
По умолчанию: не задан.  
Режим влияет на алгоритм поиска каталога, который нужно заюэкапить.  
См ниже: `eDIR_SRC`  


eCLASSIC
--------
`eCLASSIC=ON` классический режим.  
По умолчанию: не задан.  

Допустим, нужно забэкапить каталог:  
```
example
 |--- test1.txt
  `-- test2.txt
```

Если классический режим активирован,  
тогда в архив попадет содержимое `example`  
```
example.7z
 |--- test1.txt
  `-- test2.txt
```

Если же классический режим выключен,  
тогда в архив попадет каталог `example`  
```
example.7z
 |
  `-- example
       |--- test1.txt
        `-- test2.txt
```


eDIR_SRC
--------
`eDIR_SRC=..\repo` каталог, который нужно заархивировать  
По умолчанию:  
 - cначала скрипт смотрит: если существует `%eDIR_WORK%\.git`,  
   тогда `eDIR_SRC=%eDIR_WORK%\.git`  
 - в противном случае:  
   - если был задан режим `eNOSTASH=ON`, тогда  
     `eDIR_SRC=%eDIR_WORK%`  
   - иначе выполняется поиск основного репозитория: `%eDIR_WORK%\..\..\%eNAME_WORK%`, 
      - если основной репозиторий существует, тогда:  
        `eDIR_SRC=%eDIR_WORK%\..\..\%eNAME_WORK%`  
      - в противном случае:
        `eDIR_SRC=%eDIR_WORK%`  

Таким образом, если рабочий каталог - репозиторий,  
либо если задан режим  `eNOSTASH=ON`,  
либо если основного репозитория не существует,  
тогда нужно забэкапить `eDIR_WORK`  
В противном же случае, нужно забэкапить основной репозиторий.  


eDIR_DST
-------
`eDIR_DST=sample\backup` каталог, внутри которого нужно расположить архив.  
По умолчанию: `%eDIR_WORK%\_backup`  
Внутри каталога `eDIR_WORK`, скрипт может создать дополнительные подкаталоги,  
если это будет нужно в соответствии со стилем,  
который определяет значение итогового файлового пути для архива.  


ePASSWORD
---------
`ePASSWORD=**` пароль от архива  
по умолчанию: не задан  


eTIMESPAMP
----------
`eTIMESPAMP=[2024-12m-22][07h-51m]` дата создания архива  
По умолчанию: используется текущая дата и время  


eEXCLUDE
--------
`eEXCLUDE=_*;msvc-temporary;_backup;_video`  
Файловые маски каталогов или файлов, которые нужно проигнорировать.  
По умолчанию: не задан.  

Можно указать фрагменты пути, например: `docs\*.mp4`  
А если задать значение `msvc-temporary`,  
тогда добавится сразу целый список игнорируемых имен:  
  - `*.VC.opendb`, `*VC.db`, `*.sdf`, `ipch`, `.vs`  


eSTYLE
------
`eSTYLE=root-ver\date-pre` стиль файлового пути к архиву  
По умолчанию: не задан, что равносильно: `eSTYLE=root`  
 - `root` превращается в имя архивируемого каталога  
 - `ver` превращается в версию архивируемого проекта,  
   которая определяется по специальным правилам  
 - `date` превращается в временную метку, 
   которая по умолчанию совпадает с текущей датой-временем  
 - `pre` превращается в `PRE` или `REL` по специальным правилам  


Определения версии
------------------
Специальные правила определения версии проектов WorkSpace:  
Версия проекта может быть:  
 - предварительной, например: `0.0.1 PRE`  
 - релизной, например: `0.0.1 REL`  

Значение версии извлекается из файла истории: `project\docs\history.md`  
 - выполняется поиск: `%eDIR_SRC%\docs\history.md`,  
   если файла не существует, тогда `ver` схлопывается в пустоту.  
 - а если существует, тогда ищется строка вида: `[![S]][H] **v0.0.3 (dev)**`  
   - фрагмент `[S]` или `[P]` определяет `REL` или `PRE`  
     - `PRE` - предварительная версия  
     - `REL` - релизная версия  
   - фрагмент `0.0.3` определяет номер версии.  
 - в случае успешного обнаружения версии, выполняется преобразование:  
   - из номера версии удаляются точки: `0.0.3 -> 003`
   - `[S] -> REL`  
   - `[P] -> PRE`  
 - примеры:  
   - для `[![S]][H] **v0.0.3 (dev)**`, `ver=003`, `pre=REL`  
   - для `[![P]][H] **v1.2.3 (dev)**`, `ver=123`, `pre=PRE`  


История изменений 
-----------------

|  ID  |    дата    | время |      ветка     | status  |  длительность  |
|:----:|:----------:|:-----:|:--------------:|:-------:|:--------------:|
| 0001 | 2025-12-07 | 22:10 | [#4-dev-stash] | VERSION | 21 час         |

[#4-dev-stash]: ../../history.md#-v004-dev
